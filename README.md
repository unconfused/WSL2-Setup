# WSL2-Setup

## Install Windows Feature

- Open "Control Panel"
- Go to the "Programs" panel
- Go to "Turn Windows features on or off"
- Check "Windows Subsystem for Linux"
- Let install complete and reboot

![image](https://github.com/unconfused/WSL2-Setup/assets/4176101/68e601a3-f2c0-46de-a650-137b93440c71)


## Configure WSL and install distribution

- Open Powershell session as Administrator

    wsl --set-default-version 2
    wsl --install Ubuntu-22.04

## After distro install, make networking work

This method taken from:
https://askubuntu.com/questions/1450120/windows-subsystem-for-linux-2-temporary-failure-resolving-archive-ubuntu-com

Getting networking to function requires modifying the resolv.conf and wsl.conf files.  This is the ORIGINAL /etc/resolv.conf file that WSL tries to auto-generate every time you start your distro:

    # This file was automatically generated by WSL. To stop automatic generation of this file, add the following entry to /etc/wsl.conf:
    # [network]
    # generateResolvConf = false
    nameserver <your computer's IP>

To create a new /etc/resolv.conf and /etc/wsl.conf do the following which will use Google's Public DNS, stop WSL from generating the file, and make resolv.conf immutable so WSL can't remove it:

    sudo rm /etc/resolv.conf
    sudo bash -c 'echo "nameserver 8.8.8.8" > /etc/resolv.conf'
    sudo bash -c 'echo "[network]" > /etc/wsl.conf'
    sudo bash -c 'echo "generateResolvConf = false" >> /etc/wsl.conf'
    sudo chattr +i /etc/resolv.conf

Seccondly the Windows Security Policy needs to be changed to allow the network traffic.

- Open a Powershell session as Administrator
- run "secpol.msc"
- Expand "Windows Defender Firewall with Advanced Security"
- Right-click on "Windows Defender Firewall with Advanced Security - Local Group Policy Object", select Properties
  ![image](https://github.com/unconfused/WSL2-Setup/assets/4176101/f3ee4225-171c-48e1-ac05-cb8ca7c47b56)
- Under the "Public Profile" tab, in the "Settings" section, click the "Customize..." button
  ![image](https://github.com/unconfused/WSL2-Setup/assets/4176101/ee67845d-0c09-4d53-bd7a-c83e8f394ca8)
- In the "Rule merging" section, change "Apply local firewall rules" and "Apply local connection security rules" both to "Yes (default)"
  ![image](https://github.com/unconfused/WSL2-Setup/assets/4176101/e0b6a232-476a-4207-9275-96e801ed6227)

## Commonly used WSL Commands

List all installed distros
    
    wsl --list

List available distros for install online
    
    wsl --list --online

Install a specific distribution
    
    wsl --list --online
    wsl --install <disribution name>

Shutdown all running WSL distros

    wsl --shutdown

Update WSL

    wsl --update

Show WSL Defaults

    wsl --status
    
